import{f as ue,d as R,_ as pe,o as t,h as C,w as s,i as ee,n as ze,l as Be,u as e,aP as Oe,g as O,B as Ae,e as a,m as _e,j as he,aQ as Le,aR as Ge,c as u,a as h,$ as S,av as Fe,ae as T,aw as De,aG as j,as as te,al as fe,b as $,t as y,r as H,an as b,aS as Q,F as A,aT as ae,T as Re,a3 as me,am as ge,ao as ve,ad as X,aU as He,aa as D,aV as re,aW as Ie,aX as Te,ap as W,aY as je,aZ as Ee,a9 as le,a_ as Ue,a$ as Ve,b0 as qe,ag as ce}from"./index-BAvZGyJa.js";import{_ as $e,a as J,S as K,R as de,c as Xe}from"./PlayerFlagship.vue_vue_type_script_setup_true_lang-CW9bwVii.js";import{C as Ye,O as Ze,q as Ne}from"./SystemDialog.vue_vue_type_script_setup_true_lang-JxZf1buh.js";/**
 * @license lucide-vue-next v0.406.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=ue("ZoomInIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);/**
 * @license lucide-vue-next v0.406.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=ue("ZoomOutIcon",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),E=R({__name:"DropdownMenuSub",props:{defaultOpen:{type:Boolean},open:{type:Boolean}},emits:["update:open"],setup(n,{emit:o}){const w=pe(n,o);return(x,M)=>(t(),C(e(Oe),ze(Be(e(w))),{default:s(()=>[ee(x.$slots,"default")]),_:3},16))}}),U=R({__name:"DropdownMenuSubTrigger",props:{disabled:{type:Boolean},textValue:{},asChild:{type:Boolean},as:{},class:{}},setup(n){const o=n,r=O(()=>{const{class:w,...x}=o;return x}),f=Ae(r);return(w,x)=>(t(),C(e(Le),_e(e(f),{class:e(he)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",o.class)}),{default:s(()=>[ee(w.$slots,"default"),a(e(Ye),{class:"ml-auto h-4 w-4"})]),_:3},16,["class"]))}}),V=R({__name:"DropdownMenuSubContent",props:{forceMount:{type:Boolean},loop:{type:Boolean},sideOffset:{},alignOffset:{},avoidCollisions:{type:Boolean},collisionBoundary:{},collisionPadding:{},arrowPadding:{},sticky:{},hideWhenDetached:{type:Boolean},updatePositionStrategy:{},prioritizePosition:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","entryFocus","openAutoFocus","closeAutoFocus"],setup(n,{emit:o}){const r=n,f=o,w=O(()=>{const{class:M,...k}=r;return k}),x=pe(w,f);return(M,k)=>(t(),C(e(Ge),_e(e(x),{class:e(he)("z-50 min-w-32 overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r.class)}),{default:s(()=>[ee(M.$slots,"default")]),_:3},16,["class"]))}}),Qe="/Arcs-CAT/assets/board-2-CAuHClGw.jpg",Je={xmlns:"http://www.w3.org/2000/svg",width:"996",height:"923"},et=h("path",{fill:"transparent",d:"M565.5 923c40.5-36 346.5-103.5 426-85.5L996 .5 0 2z"},null,-1),tt=[et];function nt(n,o){return t(),u("svg",Je,[...tt])}const st={render:nt},ot={xmlns:"http://www.w3.org/2000/svg",width:"959",height:"937"},it=h("path",{fill:"transparent",d:"M.5 837.5c90-16.5 396 52.5 453 99L959 2 2 .5z"},null,-1),at=[it];function rt(n,o){return t(),u("svg",ot,[...at])}const lt={render:rt},ct={xmlns:"http://www.w3.org/2000/svg",width:"1678",height:"1100"},dt=h("path",{fill:"transparent",d:"M.5 939C41 942 200 1060.5 227 1099.5L1677.51 0H504.5z"},null,-1),ut=[dt];function pt(n,o){return t(),u("svg",ct,[...ut])}const _t={render:pt},ht={xmlns:"http://www.w3.org/2000/svg",width:"1142",height:"596"},ft=h("path",{fill:"transparent",d:"M153 459.5c270-94.5 552-12 712.5 136.5l276-315C873-10 315-76 0 90.5z"},null,-1),mt=[ft];function gt(n,o){return t(),u("svg",ht,[...mt])}const vt={render:gt},$t={xmlns:"http://www.w3.org/2000/svg",width:"1772",height:"1333"},yt=h("path",{fill:"transparent",d:"M.13 1133.95c19.17-4.3 180.54 194.65 160.88 199.06L1771.22 707.2 1412.64.95z"},null,-1),wt=[yt];function Ct(n,o){return t(),u("svg",$t,[...wt])}const xt={render:Ct},Pt={xmlns:"http://www.w3.org/2000/svg",width:"1601",height:"889"},St=h("path",{fill:"transparent",d:"M0 620c34 42 74 194 74 268-.08 11.31 1525.86-209.02 1526.01-230l-4-658z"},null,-1),kt=[St];function bt(n,o){return t(),u("svg",Pt,[...kt])}const Mt={render:bt},zt={xmlns:"http://www.w3.org/2000/svg",width:"1518",height:"654"},Bt=h("path",{fill:"transparent",d:"m0 226 4 198c8.51-14.36 202.01 52 250.01 76l1238 154 26-654C1512.76 35.5-3.26 248.05 0 226"},null,-1),Ot=[Bt];function At(n,o){return t(),u("svg",zt,[...Ot])}const Lt={render:At},Gt={xmlns:"http://www.w3.org/2000/svg",width:"597",height:"678"},Ft=h("path",{fill:"transparent",d:"M348 0 0 226c66 28 188 362 152 430l134 22c60-50 299.14-37.12 306-22 26-230-68-556-244-656"},null,-1),Dt=[Ft];function Rt(n,o){return t(),u("svg",Gt,[...Dt])}const Ht={render:Rt},It={xmlns:"http://www.w3.org/2000/svg",width:"1538",height:"819"},Tt=h("path",{fill:"transparent",d:"M62.35 18.63C68.54 32.44 3.44 237.91.17 230.61l1526.3 587.9 11.3-668.45L322.4.26c.07 10.97-259.94 33.63-260.05 18.37"},null,-1),jt=[Tt];function Et(n,o){return t(),u("svg",It,[...jt])}const Ut={render:Et},Vt={xmlns:"http://www.w3.org/2000/svg",width:"1722",height:"1325"},qt=h("path",{fill:"transparent",d:"M172.76.61C185.38 11.55 9.75 263.15.34 254.99L1327.37 1324.8l394.3-727.81z"},null,-1),Xt=[qt];function Yt(n,o){return t(),u("svg",Vt,[...Xt])}const Zt={render:Yt},Nt={xmlns:"http://www.w3.org/2000/svg",width:"1540",height:"1100"},Wt=h("path",{fill:"transparent",d:"M241.17.41C247.9 10.53 7.49 165.72.92 155.85l589.32 944.04 949.7-46.64z"},null,-1),Kt=[Wt];function Qt(n,o){return t(),u("svg",Nt,[...Kt])}const Jt={render:Qt},en={xmlns:"http://www.w3.org/2000/svg",width:"715",height:"718"},tn=h("path",{fill:"transparent",d:"M287.73.12C325.89 106.11 72.92 381.69.84 407.13L60.2 507.47c96.1-5.66 144.15 149.79 185.13 210.56C539.28 588.02 701.81 315.27 714.52 96.22c-.22 14.74-285.47-24.03-299.6-77.73z"},null,-1),nn=[tn];function sn(n,o){return t(),u("svg",en,[...nn])}const on={render:sn},an={xmlns:"http://www.w3.org/2000/svg",width:"948",height:"867"},rn=h("path",{fill:"transparent",d:"M433.1.27C424.62 32.78 47.29 110.51 3.48 80.83L.65 863.76l946.87 2.82z"},null,-1),ln=[rn];function cn(n,o){return t(),u("svg",an,[...ln])}const dn={render:cn},un={xmlns:"http://www.w3.org/2000/svg",width:"907",height:"883"},pn=h("path",{fill:"transparent",d:"M905.24 97.83C885.45 116.2 460.07 31.41 454.42.32L.77 868.04l905.88 14.13z"},null,-1),_n=[pn];function hn(n,o){return t(),u("svg",un,[..._n])}const fn={render:hn},mn={xmlns:"http://www.w3.org/2000/svg",width:"1534",height:"1090"},gn=h("path",{fill:"transparent",d:"M1533.77 213.66c-36.75 8.48-247.32-176.64-269.93-213.38L.41 1013.55l1085.36 76.32z"},null,-1),vn=[gn];function $n(n,o){return t(),u("svg",mn,[...vn])}const yn={render:$n},wn={xmlns:"http://www.w3.org/2000/svg",width:"1168",height:"607"},Cn=h("path",{fill:"transparent",d:"M1018.02 143.13C931.81 234.99 338.25 155.85 259.11.39L120.62 99.32C151.71 157.26 20.28 273.14.49 287.28c244.49 340.57 871.96 392.86 1167.33 230.34-29.68-57.94-171-207.73-105.99-262.85z"},null,-1),xn=[Cn];function Pn(n,o){return t(),u("svg",wn,[...xn])}const Sn={render:Pn},kn={xmlns:"http://www.w3.org/2000/svg",width:"1625",height:"1329"},bn=h("path",{fill:"transparent",d:"M1624.11 171.31c-3.45 16.97-138.61-156.52-135.67-171L.31 603.75l193.61 724.98z"},null,-1),Mn=[bn];function zn(n,o){return t(),u("svg",kn,[...Mn])}const Bn={render:zn},On={xmlns:"http://www.w3.org/2000/svg",width:"1492",height:"821"},An=h("path",{fill:"transparent",d:"M1491.85 246.31c-12.56 6.09-84.79-230.36-87.62-245.9L.9 181.3l48.05 638.77z"},null,-1),Ln=[An];function Gn(n,o){return t(),u("svg",On,[...Ln])}const Fn={render:Gn},Dn={xmlns:"http://www.w3.org/2000/svg",width:"1432",height:"597"},Rn=h("path",{fill:"transparent",d:"M1431.89 418.82c-10.34 1.6-17.4-199.52-9.9-200.68-42.39 2.83-254.38-29.68-319.39-80.55L7.35.5.29 596.89z"},null,-1),Hn=[Rn];function In(n,o){return t(),u("svg",Dn,[...Hn])}const Tn={render:In},jn={xmlns:"http://www.w3.org/2000/svg",width:"571",height:"629"},En=h("path",{fill:"transparent",d:"M570.53 420.56c-63.6-39.57-155.46-329.28-125.78-402.77L314.73.83C224.28 50.3 40.56 27.69 2.41 14.97c-12.72 145.56 21.2 428.21 224.7 613.34 29.68-15.55 132.84-127.19 204.92-108.82z"},null,-1),Un=[En];function Vn(n,o){return t(),u("svg",jn,[...Un])}const qn={render:Vn},Xn={xmlns:"http://www.w3.org/2000/svg",width:"1432",height:"799"},Yn=h("path",{fill:"transparent",d:"M1370.86 777.8c-9.38.35 54.91-210.35 60.77-210.57L.03.52l36.74 664.22L1065.6 799c46.64-40.98 223.29-36.74 305.26-21.2"},null,-1),Zn=[Yn];function Nn(n,o){return t(),u("svg",Xn,[...Zn])}const Wn={render:Nn},Kn={xmlns:"http://www.w3.org/2000/svg",width:"1695",height:"1280"},Qn=h("path",{fill:"transparent",d:"M1512.63 1279.82c-11.3-29.68 154.04-245.91 182.31-262.86L441.4.84.48 683.43z"},null,-1),Jn=[Qn];function es(n,o){return t(),u("svg",Kn,[...Jn])}const ts={render:es},ns={xmlns:"http://www.w3.org/2000/svg",width:"1433",height:"1089"},ss=h("path",{fill:"transparent",d:"M1200.35 1088.78c5.31-21.04 196.44-161.11 231.77-166.76L897.92.6.52 110.83z"},null,-1),os=[ss];function is(n,o){return t(),u("svg",ns,[...os])}const as={render:is},rs={xmlns:"http://www.w3.org/2000/svg",width:"755",height:"752"},ls=h("path",{fill:"transparent",d:"M.04 648.04C25.47 448.78 214.85 119.49 489.01.78c107.41 33.92-72.07 189.37 180.9 183.72l84.79 141.32c-86.21 26.86-282.65 336.35-292.54 425.39l-130.02-18.38c11.31-40.98-285.47-77.72-332.1-84.79"},null,-1),cs=[ls];function ds(n,o){return t(),u("svg",rs,[...cs])}const us={render:ds},ps={"1A":st,"1C":lt,"1H":_t,"1G":vt,"2A":xt,"2C":Mt,"2H":Lt,"2G":Ht,"3A":Ut,"3C":Zt,"3H":Jt,"3G":on,"4A":dn,"4C":fn,"4H":yn,"4G":Sn,"5A":Bn,"5C":Fn,"5H":Tn,"5G":qn,"6A":Wn,"6C":ts,"6H":as,"6G":us},_s=R({props:{position:{type:Object,required:!0,default(){return{x:0,y:0}}},systemConfig:{type:Object,required:!0}},emits:["click","mounted"],setup(n,{emit:o,attrs:r}){var z;const f=(z=ps[n.systemConfig.id])==null?void 0:z.render(),w=S(),x=S(),M=S(),k=S(),g=function(i){o("click",n.systemConfig.id,i)};Fe(()=>{o("mounted",{el:M.value??w.value,shape:x.value,bounds:k.value})});const L=()=>{var i;return T(f.type,{...f.props,ref:w,...r,style:{pointerEvents:"none",scale:n.systemConfig.scale,left:`${n.systemConfig.position.x}px`,top:`${n.systemConfig.position.y}px`,transformOrigin:"center",transform:"translate(-50%, -50%)"},"data-system-id":n.systemConfig.id},(i=f.children)==null?void 0:i.map(v=>T(v.type,{ref:x,style:{pointerEvents:"all"},onClick:p=>{g(p)},...v.props})))};return n.systemConfig.bounds?()=>{var i;return[T(f.type,{...f.props,ref:M,...r,style:{pointerEvents:"none",scale:n.systemConfig.scale*n.systemConfig.bounds.scale,left:`${n.systemConfig.position.x}px`,top:`${n.systemConfig.position.y}px`,transform:`translate(-${n.systemConfig.bounds.position.x}px, -${n.systemConfig.bounds.position.y}px) translate(-50%, -50%)`},"data-system-id":`${n.systemConfig.id}-bounds`},(i=f.children)==null?void 0:i.map(v=>T(v.type,{ref:k,style:{pointerEvents:"all"},...v.props}))),T(L)]}:L}}),hs=["src","alt"],fs=R({__name:"GameBoardMenu",props:{activeSystem:{},isOpen:{type:Boolean},pointerPosition:{}},emits:["update","select","close"],setup(n,{emit:o}){const r=n,f=o,w=De(),x=O(()=>w.players.length>0?w.players.map(i=>i.color):Object.values(j).filter(i=>i!==j.free&&i!==j.empire)),M=x.value.concat(j.free),k=x.value.concat(j.empire),g=O(()=>({left:`${r.pointerPosition.x}px`,top:`${r.pointerPosition.y}px`}));function L(i){f("update",i)}function z(i,v){f("select",i,v),f("close")}return(i,v)=>(t(),C(e(ve),{open:i.isOpen,"onUpdate:open":L},{default:s(()=>[a(e(fe),{class:"fixed dropdown-trigger",style:te(g.value)},null,8,["style"]),a(e(ge),null,{default:s(()=>[a(e(Ze),{options:{ignore:[".system-dialog"]},onTrigger:v[2]||(v[2]=p=>f("close"))},{default:s(()=>[a(e($e),null,{default:s(()=>[$(y(i.$t("system_id",{id:i.activeSystem})),1)]),_:1}),a(e(J)),a(e(E),null,{default:s(()=>[a(e(U),null,{default:s(()=>[$(y(i.$t("system_menu.add_ship")),1)]),_:1}),a(e(V),null,{default:s(()=>[(t(!0),u(A,null,H(e(k),p=>(t(),C(e(b),{key:p,onSelect:l=>z(e(Q).ship,p)},{default:s(()=>[$(y(i.$t(`colors.${p}`)),1)]),_:2},1032,["onSelect"]))),128))]),_:1})]),_:1}),a(e(E),null,{default:s(()=>[a(e(U),null,{default:s(()=>[$(y(i.$t("system_menu.add_flagship")),1)]),_:1}),a(e(V),null,{default:s(()=>[(t(!0),u(A,null,H(x.value,p=>(t(),C(e(b),{key:p,onSelect:l=>z(e(Q).flagship,p)},{default:s(()=>[$(y(i.$t(`colors.${p}`)),1)]),_:2},1032,["onSelect"]))),128))]),_:1})]),_:1}),a(e(E),null,{default:s(()=>[a(e(U),{class:"data-[disabled]:opacity-50"},{default:s(()=>[$(y(i.$t("system_menu.add_city")),1)]),_:1}),a(e(V),null,{default:s(()=>[(t(!0),u(A,null,H(e(M),p=>(t(),C(e(b),{key:p,onSelect:l=>z(e(ae).city,p)},{default:s(()=>[$(y(i.$t(`colors.${p}`)),1)]),_:2},1032,["onSelect"]))),128))]),_:1})]),_:1}),a(e(E),null,{default:s(()=>[a(e(U),{class:"data-[disabled]:opacity-50"},{default:s(()=>[$(y(i.$t("system_menu.add_starport")),1)]),_:1}),a(e(V),null,{default:s(()=>[(t(!0),u(A,null,H(e(M),p=>(t(),C(e(b),{key:p,onSelect:l=>z(e(ae).starport,p)},{default:s(()=>[$(y(i.$t(`colors.${p}`)),1)]),_:2},1032,["onSelect"]))),128))]),_:1})]),_:1}),a(e(E),null,{default:s(()=>[a(e(U),null,{default:s(()=>[$(y(i.$t("system_menu.add_token")),1)]),_:1}),a(e(V),null,{default:s(()=>[(t(!0),u(A,null,H(e(Re),p=>(t(),C(e(b),{key:p,onSelect:l=>z(p)},{default:s(()=>[h("img",{src:`./images/tokens/${p.toLowerCase()}.png`,alt:p,class:"h-6 mr-2"},null,8,hs),$(" "+y(i.$t(`pieces.${p}`)),1)]),_:2},1032,["onSelect"]))),128))]),_:1})]),_:1}),a(e(J)),a(Ne,{"system-id":i.activeSystem,onConfirm:v[1]||(v[1]=p=>i.$emit("close"))},{default:s(()=>[a(e(b),{onSelect:v[0]||(v[0]=me(()=>{},["prevent"]))},{default:s(()=>[$(y(i.$t("system_menu.configure")),1)]),_:1})]),_:1},8,["system-id"])]),_:1})]),_:1})]),_:1},8,["open"]))}}),ms=X(fs,[["__scopeId","data-v-9b48c341"]]),gs=R({__name:"GamePieceMenu",props:{activePiece:{},isOpen:{type:Boolean},pointerPosition:{}},emits:["update","add","remove","flip","preview"],setup(n,{emit:o}){const r=n,f=o,{t:w}=He(),x=O(()=>({left:`${r.pointerPosition.x}px`,top:`${r.pointerPosition.y}px`})),M=O(()=>{const l=w(`colors.${r.activePiece.color}`),m=w(`pieces.${r.activePiece.type}`,"group"in r.activePiece?2:1),B=r.activePiece.color?`${l} ${m}`:m;return`${B.charAt(0).toUpperCase()}${B.slice(1).toLowerCase()}`}),k=O(()=>"group"in r.activePiece?r.activePiece.group.fresh.length>0:r.activePiece.isFresh),g=O(()=>"group"in r.activePiece?r.activePiece.group.damaged.length>0:!r.activePiece.isFresh);function L(l){f("update",l)}function z(){r.activePiece.color?f("add",r.activePiece.type,r.activePiece.color):f("add",r.activePiece.type)}function i(l=!0){f("remove",l)}function v(l=!0){f("flip",l)}function p(){f("preview")}return(l,m)=>(t(),C(e(ve),{open:l.isOpen,"onUpdate:open":L},{default:s(()=>[a(e(fe),{class:"fixed dropdown-trigger",style:te(x.value)},null,8,["style"]),a(e(ge),null,{default:s(()=>[a(e($e),null,{default:s(()=>[$(y(M.value),1)]),_:1}),a(e(J)),"group"in l.activePiece?(t(),u(A,{key:0},[a(e(b),{onSelect:z},{default:s(()=>[a(e(K),{class:"mr-2",size:16}),$(" "+y(l.$t("piece_menu.add")),1)]),_:1}),k.value?(t(),C(e(b),{key:0,onSelect:m[0]||(m[0]=B=>v(!0))},{default:s(()=>[a(e(K),{class:"mr-2",size:16}),$(" "+y(l.$t("piece_menu.damage_fresh")),1)]),_:1})):D("",!0),k.value?(t(),C(e(b),{key:1,onSelect:m[1]||(m[1]=B=>i(!0))},{default:s(()=>[a(e(K),{class:"mr-2",size:16}),$(" "+y(l.$t("piece_menu.remove_fresh")),1)]),_:1})):D("",!0),g.value?(t(),C(e(b),{key:2,onSelect:m[2]||(m[2]=B=>v(!1))},{default:s(()=>[a(e(de),{class:"mr-2",size:16}),$(" "+y(l.$t("piece_menu.repair_damaged")),1)]),_:1})):D("",!0),g.value?(t(),C(e(b),{key:3,onSelect:m[3]||(m[3]=B=>i(!1))},{default:s(()=>[a(e(de),{class:"mr-2",size:16}),$(" "+y(l.$t("piece_menu.remove_damaged")),1)]),_:1})):D("",!0)],64)):(t(),u(A,{key:1},[e(re)(l.activePiece.type)?D("",!0):(t(),C(e(b),{key:0,onSelect:m[4]||(m[4]=B=>v(l.activePiece.isFresh))},{default:s(()=>[$(y(l.activePiece.isFresh?l.$t("piece_menu.damage"):l.$t("piece_menu.repair")),1)]),_:1})),e(re)(l.activePiece.type)?(t(),C(e(b),{key:1,onSelect:m[5]||(m[5]=B=>p())},{default:s(()=>[$(y(l.$t("common.view")),1)]),_:1})):D("",!0),a(e(b),{onSelect:m[6]||(m[6]=B=>i())},{default:s(()=>[$(y(l.$t("piece_menu.remove")),1)]),_:1})],64))]),_:1})]),_:1},8,["open"]))}}),vs=X(gs,[["__scopeId","data-v-cef1ccb7"]]),$s=["src"],ys={class:"map-controls"},ws=R({__name:"GameBoard",setup(n){const o=Ie();o.pause(),Te({type:"movement",eventFilter:o.eventFilter});const r=W({x:0,y:0});W({x:0,y:0});const f=W({x:0,y:0}),w=S(),x=S({x:0,y:0}),M=O(()=>({width:"max-content",transformOrigin:"top left",scale:g.value})),k=S(),g=S(1);function L(_,d){var P;const c=(P=k.value)==null?void 0:P.getBoundingClientRect();_.position.x=d.clientX/g.value-x.value.x+c.x/g.value*-1,_.position.y=d.clientY/g.value-x.value.y+c.y/g.value*-1,w.value=void 0}function z(_,d){var P;const c=(P=d.target)==null?void 0:P.getBoundingClientRect();w.value=_,x.value={x:d.clientX-c.x-c.width/2*g.value,y:d.clientY-c.y-c.height/2*g.value}}function i(_){g.value+=_,g.value<.3?g.value=.3:g.value>2&&(g.value=2)}const v=S(!1),p=S(!1),l=S(),m=S(),B=O(()=>l.value?G.systemUi(l.value,"position"):void 0);function ye(_,d){var P;let c=((P=d.target)==null?void 0:P.getBoundingClientRect())??{x:0,y:0};f.x=c.x,f.y=c.y,r.x=d.clientX,r.y=d.clientY,l.value=_,v.value=!0}function we(_){setTimeout(()=>{p.value=_})}function Ce(){setTimeout(()=>{v.value=!1,l.value=void 0})}const xe=S(!0),G=je(),Pe=O(()=>{if(!xe.value)return G.pieces;const _=new Map;return G.pieces.forEach(d=>{const c=`${d.system} ${d.color} ${d.type}`;if(Ue(d.type)||d.type===Q.flagship||Ve(d.type)&&qe(d.type)){_.set(c+d.id,d);return}const P=["system","type","color","position"];_.has(c)||_.set(c,ce.transform(d,(Z,N,I)=>{P.includes(I)&&(Z[I]=N)},{group:{damaged:[],fresh:[]}}));const F=["id","isFresh"],ie=_.get(c),Y=ce.transform(d,(Z,N,I)=>{F.includes(I)&&(Z[I]=N)},{isFresh:!0});Y.isFresh?ie.group.fresh.push(Y):ie.group.damaged.push(Y)}),Array.from(_.values())});function Se(_,d,c){r.x=c.clientX,r.y=c.clientY,m.value=_,q.value=d,l.value=_.system,p.value=!0}function ne(_,d){if(!l.value)return;let{x:c,y:P}=k.value.getBoundingClientRect();G.addPiece(l.value,{type:_,color:d},{x:r.x/g.value-c/g.value,y:r.y/g.value-P/g.value})}function ke(_){m.value&&G.removePiece(m.value,_)}function be(_){m.value&&G.flipPiece(m.value,_)}function Me(_){w.value&&G.movePiece(w.value,_)}const q=S(-1),se=S(!1);function oe(_){q.value=_?q.value:-1,se.value=_}return(_,d)=>(t(),u(A,null,[h("div",{ref_key:"wrapperEl",ref:k,id:"game-wrapper",class:"select-none",style:te(M.value)},[h("img",{src:e(Qe),alt:"Arcs",class:"max-w-max",draggable:"false"},null,8,$s),(t(!0),u(A,null,H(e(Ee),c=>(t(),C(e(_s),{key:c.id,"system-config":c,position:c.position,class:"absolute system",draggable:"false",onClick:ye,onMounted:P=>e(G).setSystemUi(c.id,P),onDragover:d[0]||(d[0]=me(()=>{},["prevent","stop"])),onDrop:P=>Me(c.id)},null,8,["system-config","position","onMounted","onDrop"]))),128)),(t(!0),u(A,null,H(Pe.value,(c,P)=>(t(),C(Xe,{key:`${c.type}${c.color?`-${c.color}`:""}-${c.system}`,"piece-config":c,"system-position":B.value,"open-preview":se.value&&q.value===P,draggable:"false",onClick:F=>Se(c,P,F),onDragstart:F=>z(c,F),onDragend:F=>L(c,F),onPreviewClose:d[1]||(d[1]=F=>oe(!1))},null,8,["piece-config","system-position","open-preview","onClick","onDragstart","onDragend"]))),128))],4),h("div",ys,[a(e(le),{size:"icon",variant:"outline",onClick:d[2]||(d[2]=c=>i(.1))},{default:s(()=>[a(e(We))]),_:1}),a(e(le),{size:"icon",variant:"outline",onClick:d[3]||(d[3]=c=>i(-.1))},{default:s(()=>[a(e(Ke))]),_:1})]),l.value?(t(),C(ms,{key:0,"active-system":l.value,"is-open":v.value,"pointer-position":r,onSelect:ne,onClose:Ce},null,8,["active-system","is-open","pointer-position"])):D("",!0),m.value?(t(),C(vs,{key:1,"active-piece":m.value,"is-open":p.value,"pointer-position":r,onAdd:ne,onRemove:ke,onFlip:be,onUpdate:we,onPreview:d[4]||(d[4]=c=>oe(!0))},null,8,["active-piece","is-open","pointer-position"])):D("",!0)],64))}}),Cs=X(ws,[["__scopeId","data-v-77dbb19b"]]),xs={class:"relative viewport"},Ps=R({__name:"CampaignView",setup(n){return(o,r)=>(t(),u("main",xs,[a(Cs)]))}}),Ms=X(Ps,[["__scopeId","data-v-94da6ce2"]]);export{Ms as default};
